---
title: 服务
slug: /key-concepts/services
---

服务代表一个后端应用程序，包含该应用程序提供的所有应用程序接口。一般来说，服务与[路由](routes.md)是一对多的关系，与[上游](upstreams.md)是一对一的关系。唯一的例外是在流量金丝雀过程中，服务会暂时有两个上游。

下图展示了一个已发布的服务，该服务架构了 Foodbar Company（一家虚构的公司）的宠物店（`store`）后台。在获取数据（[HTTP GET](https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/GET)）时，有两个配置不同的路由。

<br />
<div style={{textAlign: 'center'}}>
<img src="https://static.apiseven.com/uploads/2023/08/28/tfuuyRoQ_978a5a1ba0be7a427a8506fb42bb404.png" alt="Services Diagram" width=" 95%" />
</div>
<br /><br />

:::info

对于熟悉 Apache APISIX 的人来说，需要注意的是，API7 企业版中的服务对象与 Apache APISIX 中的服务对象是不同的。

:::

## 将插件应用于服务

请注意，“limit-count” 插件只能在服务对象上配置一次，以管理来自两个路径的传入客户端请求。

## 高可用性

为简单起见，上述示例只将流量导向一个上游节点。不过，你可以根据需要添加更多上游节点，以保持运行顺畅并对用户做出响应，同时避免单点故障。你还可以使用服务发现功能动态获取最新的上游节点。

## 服务状态

一项服务可以有多个版本，每个版本有三种状态：模板、发布或历史。这些状态代表了服务的整个 API 生命周期。对于同一个服务，版本号是相同的。不同网关组的版本号相同，可确保 API 配置相同。

### 模板

模板是初始状态，代表最新的未发布配置草案。模板中的 API 不可访问，也没有特定的版本号。

### 已发布

将模板发布到网关组会创建一个具有唯一版本号的已激活版本。已发布版本包含绑定到网关组的可访问 API，但只能对运行时配置（主机、路径前缀和上游节点）进行编辑。
要更新实时 API，必须发布新版本。模板更改不会影响已发布的版本。

### 历史

发布新版本时，以前的版本会转换为历史版本。请注意，一个服务不能同时在网关组中拥有两个已激活版本，但不同的组可以同时运行不同的版本。

历史版本为问题跟踪提供了对过去配置的可见性，但不可编辑。它们主要用于紧急回滚。

历史版本不包括[运行时配置](#运行时配置)。回滚时会保留当前值。

## 运行时配置

以下配置被归类为运行时配置。这是因为当同一服务版本发布到不同网关组时，它们可能会有不同的值，而且可以在网关组内直接编辑。这些配置并不构成不同的版本。

- 上游节点
- 服务发现
- 服务主机
- 路径前缀

:::info

例如

- 测试环境中的 API URL 是 https://api7-test.ai/v1/pet，节点地址是 127.0.0.1:80。
- 生产环境中的 API URL 是 https://api7.ai/petstore/pet，节点地址是 192.168.0.1:80。

:::
