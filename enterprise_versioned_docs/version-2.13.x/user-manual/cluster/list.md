---
title: 集群列表
slug: /user-manual/cluster/list
tags:
  - API7 Enterprise
---

## 新建集群
#### 使用场景

以下场景推荐使用多个 API7 网关集群：
1. 隔离测试环境和生产环境，可分别创建网关测试集群/网关生产集群等。
2. 隔离不同业务，可分别根据业务划分创建网关集群，如内网网关集群/公网网关集群。

#### 使用限制

1. 每个网关集群对应一个独立的控制面(Control Plane)。
2. 每个网关集群会有一到多个数据面(Data Plane)节点。不同网关集群不能共用数据面节点。
3. 每个网关集群需要独立配置用户的角色权限。
4. 如果某个网关集群发生故障，其他集群不受影响。

#### 操作步骤

**步骤1**：登录 API7 Enterprise 控制台。

**步骤2**：在顶部导航菜单，点击`集群管理`。

**步骤3**：在左侧菜单，点击`集群列表`。

**步骤4**：点击`新建`按钮。

**步骤5**：根据[名词解释](https://docs.apiseven.com/enterprise/background-information/glossary#%E9%9B%86%E7%BE%A4)，填写表单；

**步骤6**：点击`添加`按钮。

**验证方式**：集群创建成功后，可以在集群列表中看到新的集群记录。

:::info

此时集群只有控制面节点，还没有数据面节点，即使创建了上游和路由也无法真正生效。还需要参考“复制集群信息”操作添加数据面节点后，网关集群才可实际运行并接收处理业务流量。

:::

## 复制集群信息
#### 使用场景

将集群的 etcd 配置信息写入网关数据面节点，将该数据面节点添加到对应的集群。

#### 使用限制

若集群状态异常，表示无法连接 etcd 资源，此时复制的集群信息无法生效。

#### 操作步骤

**步骤1**：登录 API7 Enterprise 控制台。

**步骤2**：在顶部导航菜单，点击`集群管理`。

**步骤3**：在左侧菜单，点击`集群列表`。

**步骤4**：在列表中点击集群对应的「更多」按钮，在下拉菜单中，点击`复制集群信息`。

**步骤5**：[参考文档]，在一个新的节点上安装数据面组件 API7-Gateway。

**步骤6**：成功安装 API7-Gateway后，修改配置文件：

```sh
cat /usr/local/apisix/conf/config.yaml

etcd:
  host:
    - "http://api7-dashboard-etcd.api7.svc.cluster.local:2379"
  prefix: "/api7/452869103972058061"
  timeout: 30

```

**步骤7**：重启 API7-Gateway：

```sh
# RPM 安装
apisix restart

# docker 容器部署
docker restart ${containerID}

# k8s 部署
kubectl delete pod ${podID} -n ${namespace}

```

**验证方式**：在列表中点击集群对应的`访问`按钮进入集群，再点击左侧`网关节点`菜单，可以看到已经添加了至少一个数据面节点。

## 授权集群角色
#### 使用场景

允许某个用户对指定集群进行特定的操作。

#### 使用限制

1. 每次授权只能操作一个集群，不同集群角色需要分别授权。
2. 每个用户在同一个集群下可以拥有任意多个角色，即使这些角色可操作范围有重叠。
3. 只支持对单个用户进行角色授权，暂不支持对用户组/服务账号进行授权。

#### 操作步骤

**步骤1**：登录 API7 Enterprise 控制台。

**步骤2**：在顶部导航菜单，点击`集群管理`。

**步骤3**：在左侧菜单，点击`集群列表`。

**步骤4**：在列表中点击集群对应的`更多`按钮，在下拉菜单中，点击「授权」。

**步骤5**：选择要授权的用户。用户若还不存在，参考对应文档[新建用户](https://docs.apiseven.com/enterprise/user-manual/access-control/user#新建用户)。

**步骤6**：选择要授权的角色。如果默认角色不符合需求，先参考对应文档[新建角色](https://docs.apiseven.com/enterprise/user-manual/access-control/role#新建系统用户)。

**步骤7**：点击`更新`按钮。

**验证方式**：
1. 点击顶部导航`访问控制`菜单，在列表中找到被授权的用户，点击对应的`配置`按钮，在`用户角色`模块，可以看到打钩的已授权角色。
2. 点击对应集群的`访问`按钮进入集群，再点击左侧`集群用户`菜单，在列表中可以看到已授权的用户及其在当前集群的角色。

## 配置集群
#### 使用场景

编辑集群的名称、备注。

#### 使用限制

不支持修改集群的 etcd 资源。

#### 操作步骤

**步骤1**：登录 API7 Enterprise 控制台。

**步骤2**：在顶部导航菜单，点击`集群管理`。

**步骤3**：在左侧菜单，点击`集群列表`。

**步骤4**：点击对应集群的`更多`按钮，在下拉菜单中，点击`配置`按钮。

**步骤5**：编辑集群的名称/备注，或更换集群的 etcd 资源。

**步骤6**：点击`更新`按钮。

**验证方式**：在集群列表中，可以看到集群的名称/备注已更新。

## 删除集群
#### 使用场景

业务下线，网关集群不再使用。

#### 使用限制

1. 集群删除后不可恢复。
2. 删除集群只是销毁了控制面并清理了 etcd 中集群的所有配置，并没有销毁etcd集群及数据面节点本身。但数据面节点虽在，因无法获取到etcd中的配置，网关集群也无法继续运行。

#### 操作步骤

**步骤1**：登录 API7 Enterprise 控制台。

**步骤2**：在顶部导航菜单，点击`集群管理`。

**步骤3**：在左侧菜单，点击`集群列表`。

**步骤4**：点击对应集群的`更多`按钮，在下拉菜单中，点击`删除`按钮。

**步骤5**: 确认对业务已无影响，输入集群名称二次确认。

**步骤6**：点击`确定`按钮。

**验证方式**:在集群列表中，已看不到被删除的集群。
