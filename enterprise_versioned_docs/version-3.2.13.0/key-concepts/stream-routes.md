---
title: 四层路由
slug: /key-concepts/stream-routes
---

API7 网关有两种主要的工作模式：

1. 应用层代理，又称七层代理： 在此模式下，API7 网关 作为 HTTP 请求和响应的中介，在 OSI 模型的应用层（第7层）运作。路由用于定义如何处理这些 HTTP 请求。
2. 传输层代理，又称四层代理： API7 网关还可以作为传输层代理，在 OSI 模型的传输层（第4层）运作。此模式非常适合处理 TCP 和 UDP 等协议。对于四层代理，将使用四层路由来定义传入的 TCP/UDP 连接如何路由到后端服务。

路由或者四层路由将根据配置的规则匹配客户端请求，加载并执行相关插件，然后将请求转发到指定的上游节点。一个路由必须属于一个服务，不能孤立或在多个服务之间共享。

## 四层路由工作原理

四层路由配置中的`远程地址`字段充当了基于客户端 IP 地址的过滤器。只有源自该字段明确列出的 IP 地址的请求才被允许通过路由并到达上游服务（例如 MySQL 服务器）。

例如，假设你有一个仅供内部使用的 MySQL 服务器。你可以创建一个四层路由，其远程地址过滤器设置为公司的内部 IP 范围。这将只允许来自你网络中授权机器的连接通过 API7 网关访问 MySQL 服务器。

API7 网关还提供除客户端 IP 过滤之外的额外过滤选项。四层路由配置中的`服务器地址`和`服务器端口`字段，让你可以对传入连接进行更精细的控制。你可以指定上游服务的允许服务器地址和端口，进一步限制对授权目的地的访问。

## 相关阅读

- 核心概念 - [服务](services.md), [上游](upstreams.md)
- 快速入门
  - [转发四层流量](../getting-started/proxy-l4-traffic.md).
